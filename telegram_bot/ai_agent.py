#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Naxvat SeaFood AI Agent
Telegram Bot with AI capabilities for seafood shop

Author: Naxvat SeaFood
Version: 1.0.0
"""

import os
import sys
import json
import time
import logging
from datetime import datetime
from typing import Dict, List, Optional
from dataclasses import dataclass, field

# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğ´Ğ»Ñ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ¯
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

try:
    from bot_config import BOT_TOKEN, OWNER_CHAT_ID, BOT_SETTINGS, OPENAI_API_KEY
except ImportError:
    logger.error("ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ñ„Ğ°Ğ¹Ğ» ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸!")
    sys.exit(1)

try:
    from products_knowledge import (
        PRODUCTS, find_product, get_all_products, get_all_categories,
        format_product_info, format_catalog, search_by_price_range
    )
except ImportError:
    logger.error("ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ° Ğ±Ğ°Ğ·Ğ° Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²!")
    sys.exit(1)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ« Ğ”ĞĞĞĞ«Ğ¥
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@dataclass
class CartItem:
    """Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹"""
    product_id: str
    name: str
    weight: str
    price: float
    quantity: int = 1
    
    @property
    def total(self) -> float:
        return self.price * self.quantity

@dataclass
class UserSession:
    """Ğ¡ĞµÑÑĞ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
    user_id: int
    username: Optional[str] = None
    first_name: Optional[str] = None
    cart: List[CartItem] = field(default_factory=list)
    state: str = "start"  # start, browsing, ordering, checkout
    last_activity: datetime = field(default_factory=datetime.now)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# AI ENGINE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class AIResponseEngine:
    """
    AI-Ğ´Ğ²Ğ¸Ğ¶Ğ¾Ğº Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ÑƒĞ¼Ğ½Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ
    Ğ±Ğ°Ğ·Ñ‹ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ².
    """
    
    # ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ° Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°
    INTENTS = {
        "greeting": ["Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚", "Ğ·Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹", "Ğ·Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ", "Ğ´Ğ¾Ğ±Ñ€Ñ‹Ğ¹", "Ğ´Ğ¾Ğ±Ñ€Ğ¾Ğµ", "hello", "hi", "hey"],
        "goodbye": ["Ğ¿Ğ¾ĞºĞ°", "Ğ´Ğ¾ ÑĞ²Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ", "Ğ´Ğ¾ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ¸", "bye", "goodbye"],
        "catalog": ["ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³", "Ğ¼ĞµĞ½Ñ", "Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹", "Ñ‡Ñ‚Ğ¾ Ñƒ Ğ²Ğ°Ñ ĞµÑÑ‚ÑŒ", "Ğ°ÑÑĞ¾Ñ€Ñ‚Ğ¸Ğ¼ĞµĞ½Ñ‚", "Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ", "Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ"],
        "price": ["Ñ†ĞµĞ½Ğ°", "ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ", "ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ğ¾Ğ¸Ñ‚", "Ñ†ĞµĞ½Ñ‹", "ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ"],
        "order": ["Ğ·Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ", "ĞºÑƒĞ¿Ğ¸Ñ‚ÑŒ", "Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ", "Ñ…Ğ¾Ñ‡Ñƒ", "Ğ½ÑƒĞ¶Ğ½Ğ¾", "Ğ·Ğ°ĞºĞ°Ğ·"],
        "delivery": ["Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°", "Ğ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ", "ĞºÑƒÑ€ÑŒĞµÑ€", "Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚", "Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ°"],
        "caviar": ["Ğ¸ĞºÑ€Ğ°", "ĞºÑ€Ğ°ÑĞ½Ğ°Ñ Ğ¸ĞºÑ€Ğ°", "Ñ‡ĞµÑ€Ğ½Ğ°Ñ Ğ¸ĞºÑ€Ğ°", "ĞºĞµÑ‚Ğ°", "Ñ„Ğ¾Ñ€ĞµĞ»ÑŒ", "Ğ³Ğ¾Ñ€Ğ±ÑƒÑˆĞ°", "Ğ¾ÑĞµÑ‚Ñ€", "Ğ±ĞµĞ»ÑƒĞ³Ğ°"],
        "crab": ["ĞºÑ€Ğ°Ğ±", "king crab", "kingkrab", "blue crab", "ĞºĞ¾Ñ€Ğ¾Ğ»ĞµĞ²ÑĞºĞ¸Ğ¹"],
        "lobster": ["Ğ»Ğ¾Ğ±ÑÑ‚ĞµÑ€", "Ñ€Ğ°ĞºĞ¸", "Ñ€Ğ°Ğº"],
        "snack_box": ["ÑĞ½ĞµĞº", "Ğ±Ğ¾ĞºÑ", "Ğ¼Ğ¸ĞºÑ", "Ğ½Ğ°Ğ±Ğ¾Ñ€", "ÑĞµÑ‚"],
        "availability": ["Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ", "ĞµÑÑ‚ÑŒ Ğ² Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğ¸", "Ğ² Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğ¸", "ĞµÑÑ‚ÑŒ Ğ»Ğ¸", "Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ"],
        "thanks": ["ÑĞ¿Ğ°ÑĞ¸Ğ±Ğ¾", "Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ñ", "Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ½Ğ¾ÑÑ‚ÑŒ", "thanks"],
        "help": ["Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ", "help", "Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ¸", "Ğ½Ğµ Ğ¿Ğ¾Ğ½ÑĞ»", "Ğ½Ğµ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ"]
    }
    
    def __init__(self):
        self.products = get_all_products()
        self.categories = get_all_categories()
    
    def detect_intent(self, message: str) -> List[str]:
        """ĞĞ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ¸Ğ½Ñ‚ĞµĞ½Ñ‚(Ñ‹) ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ"""
        message_lower = message.lower()
        intents = []
        
        for intent, keywords in self.INTENTS.items():
            for keyword in keywords:
                if keyword in message_lower:
                    if intent not in intents:
                        intents.append(intent)
                    break
        
        return intents if intents else ["unknown"]
    
    def find_products_in_message(self, message: str) -> List:
        """ĞĞ°Ğ¹Ñ‚Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹, ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµĞ¼Ñ‹Ğµ Ğ² ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸"""
        found = []
        message_lower = message.lower()
        
        for product in self.products:
            for keyword in product.get("keywords", []):
                if keyword.lower() in message_lower:
                    if product not in found:
                        found.append(product)
                    break
        
        return found
    
    def generate_response(self, message: str, user_name: Optional[str] = None) -> str:
        """
        ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ˜Ğ˜
        """
        message = message.strip()
        intents = self.detect_intent(message)
        found_products = self.find_products_in_message(message)
        
        # Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¸Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        name_part = f", {user_name}!" if user_name else "!"
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ•
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "greeting" in intents:
            return f"""
ğŸ¦ Ğ”Ğ¾Ğ±Ñ€Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ{name_part}

Ğ Ğ°Ğ´ Ğ²Ğ°Ñ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ² *Naxvat SeaFood*! 

ĞœÑ‹ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ÑÑ Ğ½Ğ° Ğ¿Ñ€ĞµĞ¼Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¼Ğ¾Ñ€ĞµĞ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°Ñ…:
â€¢ ĞšÑ€Ğ°ÑĞ½Ğ°Ñ Ğ¸ Ñ‡ĞµÑ€Ğ½Ğ°Ñ Ğ¸ĞºÑ€Ğ°
â€¢ Ğ¡Ğ²ĞµĞ¶Ğ¸Ğµ Ñ€Ğ°ĞºĞ¸ Ğ¸ Ğ»Ğ¾Ğ±ÑÑ‚ĞµÑ€Ñ‹
â€¢ ĞšÑ€Ğ°Ğ±Ñ‹ King Crab, Blue Crab
â€¢ Ğ¡Ğ½ĞµĞº-Ğ±Ğ¾ĞºÑÑ‹ Ñ Ğ¼Ğ¾Ñ€ĞµĞ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°Ğ¼Ğ¸
â€¢ ĞŸÑ€ĞµĞ¼Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ‚Ğ°Ñ€Ğ°Ğ½ÑŒĞºĞ°

Ğ§ĞµĞ¼ Ğ¼Ğ¾Ğ³Ñƒ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‡ÑŒ? ĞœĞ¾Ğ¶ĞµÑ‚Ğµ:
â€¢ Ğ¡Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€
â€¢ Ğ£Ğ·Ğ½Ğ°Ñ‚ÑŒ Ñ†ĞµĞ½Ñ‹
â€¢ Ğ—Ğ°ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºÑƒ
â€¢ ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # ĞŸĞ ĞĞ©ĞĞĞ˜Ğ•
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "goodbye" in intents:
            return f"""
Ğ”Ğ¾ Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ¸{name_part} Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ² Naxvat SeaFood! ğŸ¦

Ğ–Ğ´Ñ‘Ğ¼ Ğ²Ğ°Ñ ÑĞ½Ğ¾Ğ²Ğ° Ğ·Ğ° Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¼Ğ¸ Ğ¼Ğ¾Ñ€ĞµĞ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°Ğ¼Ğ¸!

ğŸ“± Ğ—Ğ°ĞºĞ°Ğ·: @naxvatseafood_manager
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # Ğ‘Ğ›ĞĞ“ĞĞ”ĞĞ ĞĞĞ¡Ğ¢Ğ¬
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "thanks" in intents:
            return f"""
ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°{name_part} Ğ Ğ°Ğ´Ñ‹ Ğ±Ñ‹Ğ»Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‡ÑŒ! 

Ğ•ÑĞ»Ğ¸ Ğ²Ğ¾Ğ·Ğ½Ğ¸ĞºĞ½ÑƒÑ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ â€” Ğ²ÑĞµĞ³Ğ´Ğ° Ğ¾Ğ±Ñ€Ğ°Ñ‰Ğ°Ğ¹Ñ‚ĞµÑÑŒ! ğŸ¦

ğŸ“± @naxvatseafood_manager
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # ĞšĞĞ¢ĞĞ›ĞĞ“
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "catalog" in intents:
            return f"""
ğŸ“‹ *ĞšĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ Naxvat SeaFood*

"""
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # ĞĞĞ›Ğ˜Ğ§Ğ˜Ğ•
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "availability" in intents and found_products:
            product_names = ", ".join([p["name"] for p in found_products[:3]])
            return f"""
âœ… *{product_names}* â€” Ğ² Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğ¸!

Ğ¦ĞµĞ½Ñ‹ Ğ¸ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸ ÑƒÑ‚Ğ¾Ñ‡Ğ½ÑĞ¹Ñ‚Ğµ, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¼ ÑĞ¿Ñ€Ğ¾ÑĞ¾Ğ¼. ğŸ¦

Ğ”Ğ»Ñ Ğ·Ğ°ĞºĞ°Ğ·Ğ°: @naxvatseafood_manager
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # ĞšĞĞĞšĞ Ğ•Ğ¢ĞĞ«Ğ• Ğ¢ĞĞ’ĞĞ Ğ«
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if found_products:
            response_parts = []
            for product in found_products[:5]:  # ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 5 Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
                response_parts.append(f"""
ğŸ“¦ *{product['name']}*
   ğŸ“Š Ğ¤Ğ°ÑĞ¾Ğ²ĞºĞ°: {product['weight']}
   ğŸ’° Ğ¦ĞµĞ½Ğ°: {product['price']} zÅ‚

_{product.get('description', '')}_
""".strip())
            
            return """
{products}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ğ”Ğ»Ñ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ·Ğ°ĞºĞ°Ğ·Ğ° Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ @naxvatseafood_manager Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ "ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ Ğ·Ğ°ĞºĞ°Ğ·"!

ğŸ’¡ Ğ¥Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ·Ğ½Ğ°Ñ‚ÑŒ Ğ¾ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°Ñ…?
            """.strip().format(products="\n".join(response_parts))
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # Ğ˜ĞšĞ Ğ
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "caviar" in intents:
            return f"""
ğŸŸ *ĞšÑ€Ğ°ÑĞ½Ğ°Ñ Ğ¸ĞºÑ€Ğ°* â€” Ğ½Ğ°Ñˆ Ñ…Ğ¸Ñ‚ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶!

ğŸ“Š *Ğ˜ĞºÑ€Ğ° ĞºĞµÑ‚Ğ¸ ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼:*
   â€¢ 100Ğ³ â€” 95 zÅ‚
   â€¢ 250Ğ³ â€” 250 zÅ‚
   â€¢ 500Ğ³ â€” 470 zÅ‚

ğŸ“Š *Ğ˜ĞºÑ€Ğ° Ñ„Ğ¾Ñ€ĞµĞ»Ğ¸ ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼:*
   â€¢ 250Ğ³ â€” 160 zÅ‚
   â€¢ 500Ğ³ â€” 305 zÅ‚

ğŸ“Š *Ğ˜ĞºÑ€Ğ° Ğ³Ğ¾Ñ€Ğ±ÑƒÑˆĞ¸ ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼:*
   â€¢ 100Ğ³ â€” 90 zÅ‚
   â€¢ 250Ğ³ â€” 230 zÅ‚
   â€¢ 500Ğ³ â€” 420 zÅ‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ¨ *Ğ‘ĞµĞ· ĞºĞ¾Ğ½ÑĞµÑ€Ğ²Ğ°Ğ½Ñ‚Ğ¾Ğ²:*
   â€¢ ĞšĞµÑ‚Ğ° 1ĞºĞ³ â€” 880 zÅ‚
   â€¢ ĞšĞ¸Ğ¶ÑƒÑ‡ 1ĞºĞ³ â€” 850 zĞ»
   â€¢ Ğ“Ğ¾Ñ€Ğ±ÑƒÑˆĞ° 1ĞºĞ³ â€” 800 zÅ‚
   â€¢ Ğ¤Ğ¾Ñ€ĞµĞ»ÑŒ 1ĞºĞ³ â€” 530 zÅ‚

ğŸ“± Ğ—Ğ°ĞºĞ°Ğ·: @naxvatseafood_manager
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # ĞšĞ ĞĞ‘Ğ«
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "crab" in intents:
            return f"""
ğŸ¦€ *ĞšÑ€Ğ°Ğ±Ñ‹ Ğ¿Ñ€ĞµĞ¼Ğ¸ÑƒĞ¼*

ğŸ“Š *King Crab â€” Ğ¿ĞµÑ€Ğ²Ğ°Ñ Ñ„Ğ°Ğ»Ğ°Ğ½Ğ³Ğ°:*
   â€¢ 250Ğ³ â€” 289 zÅ‚
   â€¢ 400Ğ³ â€” 444 zÅ‚
   â€¢ 520Ğ³ â€” 599 zÅ‚
   â€¢ 720Ğ³ â€” 779 zÅ‚

ğŸ“Š *Blue Crab meat:*
   â€¢ 454Ğ³ â€” 170 zÅ‚

ğŸ“Š *Ğ”Ñ€ÑƒĞ³Ğ¸Ğµ ĞºÑ€Ğ°Ğ±Ñ‹:*
   â€¢ ĞšĞ»ĞµÑˆĞ½Ğ¸ ÑĞ½ĞµĞ¶Ğ½Ğ¾Ğ³Ğ¾ ĞºÑ€Ğ°Ğ±Ğ° â€” 240 zÅ‚/ĞºĞ³
   â€¢ ĞšĞ»ĞµÑˆĞ½Ğ¸ ĞºĞ¾Ñ€Ğ¾Ğ»ĞµĞ²ÑĞºĞ¾Ğ³Ğ¾ ĞºÑ€Ğ°Ğ±Ğ° â€” 950 zÅ‚/ĞºĞ³
   â€¢ ĞœÑÑĞ¾ ĞºĞ¾Ñ€Ğ¾Ğ»ĞµĞ²ÑĞºĞ¾Ğ³Ğ¾ ĞºÑ€Ğ°Ğ±Ğ° â€” 950 zÅ‚/ĞºĞ³

ğŸ“± Ğ—Ğ°ĞºĞ°Ğ·: @naxvatseafood_manager
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # Ğ›ĞĞ‘Ğ¡Ğ¢Ğ•Ğ Ğ« Ğ˜ Ğ ĞĞšĞ˜
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "lobster" in intents:
            return f"""
ğŸ¦ *Ğ Ğ°ĞºĞ¸ Ğ¸ Ğ»Ğ¾Ğ±ÑÑ‚ĞµÑ€Ñ‹*

ğŸ“Š *Ğ Ğ°ĞºĞ¸ Ğ¶Ğ¸Ğ²Ñ‹Ğµ:*
   â€¢ 190/240 (Ğ·Ğ° ÑˆÑ‚ÑƒĞºÑƒ) â€” 190 zÅ‚/ĞºĞ³
   â€¢ Ğ’Ğ°Ñ€ĞºĞ° â€” +39-70 zÅ‚/ĞºĞ³

ğŸ“Š *Ğ›Ğ¾Ğ±ÑÑ‚ĞµÑ€Ñ‹ (ĞšĞ°Ğ½Ğ°Ğ´Ğ°/Ğ•Ğ¡):*
   â€¢ 350-400Ğ³ â€” 250 zÅ‚/ĞºĞ³
   â€¢ 500-800Ğ³ â€” 360 zÅ‚/ĞºĞ³
   â€¢ 1ĞºĞ³+ â€” 410 zÅ‚/ĞºĞ³
   â€¢ Ğ’Ğ°Ñ€ĞºĞ° â€” +20 zÅ‚/ĞºĞ³

Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²ĞµĞ¶Ğ¸Ğµ! ğŸ¦

ğŸ“± Ğ—Ğ°ĞºĞ°Ğ·: @naxvatseafood_manager
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # Ğ¡ĞĞ•Ğš-Ğ‘ĞĞšĞ¡Ğ«
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "snack_box" in intents:
            return f"""
ğŸ“¦ *Ğ¡Ğ½ĞµĞº-Ğ±Ğ¾ĞºÑÑ‹* â€” Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ğ½Ğ°Ğ±Ğ¾Ñ€Ñ‹!

ğŸ’° *Ğ‘ÑĞ´Ğ¶ĞµÑ‚Ğ½Ñ‹Ğµ:*
   â€¢ 100 zÅ‚ â€” 1ĞºĞ³
   â€¢ 150 zÅ‚ â€” 1.5ĞºĞ³
   â€¢ 200 zÅ‚ â€” 2ĞºĞ³

â­ *ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼:*
   â€¢ Arriwa â€” 2.5ĞºĞ³ Ğ·Ğ° 250 zÅ‚
   â€¢ MAX â€” 2.3ĞºĞ³+ Ğ·Ğ° 250 zÅ‚ (Ğ’Ğ¡Ğ• Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¾!)

ğŸ *Ğ’ Ğ±Ğ¾ĞºÑĞ°Ñ…:* ĞºÑ€Ğ°Ğ±Ğ¾Ğ²Ñ‹Ğµ Ğ¿Ğ°Ğ»Ğ¾Ñ‡ĞºĞ¸, ĞºĞ°Ğ»ÑŒĞ¼Ğ°Ñ€Ñ‹, Ñ‚ÑƒĞ½ĞµÑ†, Ğ»Ğ¾ÑĞ¾ÑÑŒ, Ğ°Ğ½Ñ‡Ğ¾ÑƒÑÑ‹ Ğ¸ Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ğµ Ğ´Ñ€ÑƒĞ³Ğ¾Ğµ!

ğŸ“± Ğ—Ğ°ĞºĞ°Ğ·: @naxvatseafood_manager
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # Ğ¦Ğ•ĞĞ/Ğ¡Ğ¢ĞĞ˜ĞœĞĞ¡Ğ¢Ğ¬
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "price" in intents or "order" in intents:
            return f"""
ğŸ’° *Ğ¦ĞµĞ½Ñ‹ Ğ½Ğ° Ğ¿Ğ¾Ğ¿ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹:*

ğŸ“Š *Ğ˜ĞºÑ€Ğ°:*
   â€¢ ĞšĞµÑ‚Ğ° 100Ğ³ â€” 95 zÅ‚
   â€¢ Ğ¤Ğ¾Ñ€ĞµĞ»ÑŒ 250Ğ³ â€” 160 zÅ‚
   â€¢ Ğ“Ğ¾Ñ€Ğ±ÑƒÑˆĞ° 500Ğ³ â€” 420 zÅ‚

ğŸ“Š *ĞœĞ¾Ñ€ĞµĞ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ñ‹:*
   â€¢ Ğ¥Ğ²Ğ¾ÑÑ‚Ñ‹ Ğ»Ğ°Ğ½Ğ³ÑƒÑÑ‚Ğ¾Ğ² â€” 550 zÅ‚/ĞºĞ³
   â€¢ King Crab 250Ğ³ â€” 289 zÅ‚
   â€¢ ĞšĞ»ĞµÑˆĞ½Ğ¸ ÑĞ½ĞµĞ¶Ğ½Ğ¾Ğ³Ğ¾ ĞºÑ€Ğ°Ğ±Ğ° â€” 240 zÅ‚/ĞºĞ³

ğŸ“Š *Ğ¡Ğ½ĞµĞº-Ğ±Ğ¾ĞºÑÑ‹:*
   â€¢ ĞœĞ¸ĞºÑĞ±Ğ¾ĞºÑ 950Ğ³ â€” 120 zÅ‚
   â€¢ Ğ‘Ğ¾ĞºÑ 200 zÅ‚ â€” 2ĞºĞ³

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ğ”Ğ»Ñ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ° Ğ·Ğ°ĞºĞ°Ğ·Ğ° Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ @naxvatseafood_manager!
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # Ğ”ĞĞ¡Ğ¢ĞĞ’ĞšĞ
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "delivery" in intents:
            return f"""
ğŸšš *Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ²ÑĞµĞ¹ ĞŸĞ¾Ğ»ÑŒÑˆĞµ!*

ğŸ“¦ ĞŸÑ€Ğ¸ Ğ·Ğ°ĞºĞ°Ğ·Ğµ Ğ¾Ñ‚ 500 zÅ‚ â€” *Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°*! ğŸ

ğŸ“ Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶ĞµĞ½ ÑĞ°Ğ¼Ğ¾Ğ²Ñ‹Ğ²Ğ¾Ğ·.

ğŸ’° Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° Ñ€Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ğ¾Ğ±ÑŠÑ‘Ğ¼Ğ°.

ğŸ“± Ğ”Ğ»Ñ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ° Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ @naxvatseafood_manager Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°!
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # ĞŸĞĞœĞĞ©Ğ¬
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        if "help" in intents or "unknown" in intents:
            return f"""
ğŸ¤– Ğ§ĞµĞ¼ Ğ¼Ğ¾Ğ³Ñƒ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‡ÑŒ{name_part}

Ğ¯ Ğ¼Ğ¾Ğ³Ñƒ Ñ€Ğ°ÑÑĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¾:
ğŸŸ Ğ˜ĞºÑ€Ğµ (ĞºÑ€Ğ°ÑĞ½Ğ¾Ğ¹ Ğ¸ Ñ‡ĞµÑ€Ğ½Ğ¾Ğ¹)
ğŸ¦ Ğ Ğ°ĞºĞ°Ñ… Ğ¸ Ğ»Ğ¾Ğ±ÑÑ‚ĞµÑ€Ğ°Ñ…
ğŸ¦€ ĞšÑ€Ğ°Ğ±Ğ°Ñ… (King Crab, Blue Crab)
ğŸ“¦ Ğ¡Ğ½ĞµĞº-Ğ±Ğ¾ĞºÑĞ°Ñ…
ğŸšš Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞµ
ğŸ’° Ğ¦ĞµĞ½Ğ°Ñ…

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“± *Ğ–Ğ¸Ğ²Ğ¾Ğ¹ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº:* @naxvatseafood_manager
            """.strip()
        
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        # DEFAULT
        # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        return f"""
Ğ˜Ğ·Ğ²Ğ¸Ğ½Ğ¸Ñ‚Ğµ{name_part} ĞĞµ ÑĞ¾Ğ²ÑĞµĞ¼ Ğ¿Ğ¾Ğ½ÑĞ» Ğ²Ğ°Ñˆ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ. ğŸ¤”

ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ñ‚ÑŒ:
â€¢ ĞšĞ°ĞºĞ¾Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ²Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµÑÑƒĞµÑ‚?
â€¢ Ğ¥Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ·Ğ½Ğ°Ñ‚ÑŒ Ñ†ĞµĞ½Ñ‹?
â€¢ ĞÑƒĞ¶Ğ½Ğ° Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°?

Ğ˜Ğ»Ğ¸ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ @naxvatseafood_manager Ğ´Ğ»Ñ ÑĞ²ÑĞ·Ğ¸ Ñ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ¾Ğ¼! ğŸ‘¨â€ğŸ’¼
        """.strip()


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ Ğ¡Ğ•Ğ¡Ğ¡Ğ˜Ğ¯ĞœĞ˜
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class SessionManager:
    """ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ÑĞµÑÑĞ¸Ğ¹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹"""
    
    def __init__(self):
        self.sessions: Dict[int, UserSession] = {}
        self.ai_engine = AIResponseEngine()
    
    def get_session(self, user_id: int, username: Optional[str] = None, 
                   first_name: Optional[str] = None) -> UserSession:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ÑĞµÑÑĞ¸Ñ"""
        if user_id not in self.sessions:
            self.sessions[user_id] = UserSession(
                user_id=user_id,
                username=username,
                first_name=first_name
            )
        else:
            # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ
            self.sessions[user_id].username = username
            self.sessions[user_id].first_name = first_name
        
        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
        self.sessions[user_id].last_activity = datetime.now()
        
        return self.sessions[user_id]
    
    def get_cart(self, user_id: int) -> List[CartItem]:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
        session = self.get_session(user_id)
        return session.cart
    
    def add_to_cart(self, user_id: int, product_id: str, name: str, 
                   weight: str, price: float, quantity: int = 1):
        """Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ"""
        session = self.get_session(user_id)
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ Ñ‚Ğ°ĞºĞ¾Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€
        for item in session.cart:
            if item.product_id == product_id:
                item.quantity += quantity
                return
        
        # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€
        session.cart.append(CartItem(
            product_id=product_id,
            name=name,
            weight=weight,
            price=price,
            quantity=quantity
        ))
    
    def remove_from_cart(self, user_id: int, product_id: str):
        """Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ¸Ğ· ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹"""
        session = self.get_session(user_id)
        session.cart = [item for item in session.cart if item.product_id != product_id]
    
    def update_cart_quantity(self, user_id: int, product_id: str, quantity: int):
        """ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°"""
        session = self.get_session(user_id)
        for item in session.cart:
            if item.product_id == product_id:
                if quantity <= 0:
                    session.cart.remove(item)
                else:
                    item.quantity = quantity
                break
    
    def clear_cart(self, user_id: int):
        """ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ"""
        session = self.get_session(user_id)
        session.cart = []
    
    def get_cart_total(self, user_id: int) -> float:
        """ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑƒĞ¼Ğ¼Ñƒ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñ‹"""
        session = self.get_session(user_id)
        return sum(item.total for item in session.cart)
    
    def format_cart(self, user_id: int) -> str:
        """Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°"""
        session = self.get_session(user_id)
        
        if not session.cart:
            return "ğŸ›’ *ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¿ÑƒÑÑ‚Ğ°*\n\nĞ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ¸Ğ· ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ°!"
        
        lines = ["ğŸ›’ *Ğ’Ğ°ÑˆĞ° ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°:*\n"]
        
        for item in session.cart:
            lines.append(f"â€¢ {item.name} ({item.weight})")
            lines.append(f"  {item.quantity} Ã— {item.price} zÅ‚ = *{item.total} zÅ‚*")
            lines.append("")
        
        total = self.get_cart_total(user_id)
        lines.append(f"_Ğ˜Ñ‚Ğ¾Ğ³Ğ¾: *{total} zÅ‚*_")
        
        return "\n".join(lines)
    
    def process_message(self, user_id: int, message: str, 
                       username: Optional[str] = None,
                       first_name: Optional[str] = None) -> str:
        """ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¸ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚"""
        session = self.get_session(user_id, username, first_name)
        
        # ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸
        session.last_activity = datetime.now()
        
        # Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ñ‡ĞµÑ€ĞµĞ· AI
        response = self.ai_engine.generate_response(message, first_name)
        
        return response


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# MAIN
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def main():
    """ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°"""
    logger.info("ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Naxvat SeaFood AI Agent...")
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
    if not BOT_TOKEN:
        logger.error("ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½ Ñ‚Ğ¾ĞºĞµĞ½ Ğ±Ğ¾Ñ‚Ğ°!")
        sys.exit(1)
    
    # Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ ÑĞµÑÑĞ¸Ğ¹
    session_manager = SessionManager()
    
    logger.info("âœ… Naxvat SeaFood AI Agent Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½!")
    logger.info(f"ğŸ“Š Ğ¢Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ² Ğ±Ğ°Ğ·Ğµ: {len(session_manager.ai_engine.products)}")
    logger.info(f"ğŸ“ ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹: {len(session_manager.ai_engine.categories)}")
    
    # Ğ—Ğ´ĞµÑÑŒ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ²ĞµĞ±-ÑĞµÑ€Ğ²ĞµÑ€Ğ° Ğ´Ğ»Ñ webhook
    # Ğ˜Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ polling
    
    print("\n" + "="*50)
    print("ğŸ¦ Naxvat SeaFood AI Agent Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ!")
    print("="*50)
    print(f"\nğŸ“± Ğ’Ğ°Ñˆ Ğ±Ğ¾Ñ‚: @naxvatseafood_manager")
    print("\nğŸ’¡ Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ğ¾Ğ¹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ")
    print("   Ğ²ĞµĞ±Ñ…ÑƒĞº Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ polling.\n")


if __name__ == "__main__":
    main()
